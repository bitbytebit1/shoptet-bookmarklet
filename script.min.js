javascript:const pepisShop={elements:{cartTable:qs(".cart-table"),carts:qsa('[data-micro="cartItem"]'),cartItemInput:qsa('[data-testid="cartAmount"]'),recapFullPrice:qs('[data-testid="recapFullPrice"]'),deliveryTime:qs(".delivery-time")},addToCart:{headers:{"X-Shoptet-XHR":"Shoptet_Coo7ai","X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},messages:{success:/Množství bylo úspěšně změněno\./,notEnoughStock1:/Tento produkt má omezený počet kusů, které je možno zakoupit/,notEnoughStock2:/Maximálně lze objednat \d+ kusů produktů\.<br\/>Množství nebylo změněno\./},url:"https://www.pepis.shop/action/Cart/setCartItemAmount/"}};function init(){qs("[data-byte-update-cart]")?alert("Sorry babe, already injected, refresh the page and try again"):(addProxyInputs(),addUpdateButton(),addSetAll(),fixTabIndexes())}function fixTabIndexes(){pepisShop.elements.carts.forEach(e=>{e.querySelector('[data-testid="cartProductName"] .main-link').tabIndex=-1,e.querySelector(".cart-p-image a").tabIndex=-1,e.querySelector('[data-testid="buttonDeleteItem"]').tabIndex=-1})}function addProxyInputs(){pepisShop.elements.cartItemInput.forEach(t=>{const a=document.createElement("input");a.type="number",a.value=t.value,a.min=1,a.style.width="50px",a.style.marginRight="-23px",a.dataset.byteInputProxy=!0,a.tabIndex=0,t.parentNode.insertBefore(a,t.nextSibling),t.style.display="none",t.parentNode.querySelector(".increase").style.display="none",t.parentNode.querySelector(".decrease").style.display="none",a.addEventListener("change",async e=>{a.dataset.byteInputDirty=!0}),a.addEventListener("keyup",async e=>{t.value=e.target.value,updateRowPrice([t.closest('[data-micro="cartItem"]')])})})}function updateRowPrice(e){e.forEach(e=>{var t=e.querySelector('[data-testid="cartAmount"]').value,a=e.querySelector('[data-testid="cartItemPrice"]'),r=e.querySelector('.p-discount [data-testid="cartItemDiscount"]'),e=e.querySelector('[data-testid="cartPrice"]'),a=convertStringToNumber(a.innerText),r=a*((r?.innerText?.replace?.(/\D/g,"")||0)/100).toFixed(2),a=Number(a-r).toFixed(2);e.innerText=convertNumberToString(a*t)}),updateTotal()}function updateTotal(){let t=0;qsa('[data-testid="cartPrice"]').forEach(e=>{t+=convertStringToNumber(e.innerText)}),pepisShop.elements.recapFullPrice.innerText=convertNumberToString(t)}function addSetAll(){var e=document.createElement("div"),t=(e.style.margin="10px",e.id="setAll",document.createElement("span")),t=(t.innerText="Set all items to: ",e.appendChild(t),document.createElement("input")),a=(t.type="number",t.value=24,t.width="150px",t.height="50px",t.dataset.byteSetAllInput=!0,document.createElement("button"));a.innerText="Set all",a.style.marginLeft="10px",a.dataset.byteSetAllButton=!0,e.appendChild(t),e.appendChild(a),pepisShop.elements.cartTable.insertAdjacentHTML("beforebegin",e.outerHTML),qs("[data-byte-set-all-button]").addEventListener("click",e=>{const t=qs("[data-byte-set-all-input]").value;qsa("[data-byte-input-proxy]").forEach(e=>{e.value=t,e.parentNode.querySelector('[data-testid="cartAmount"]').value=t}),updateRowPrice(pepisShop.elements.carts)})}function addUpdateButton(){pepisShop.elements.deliveryTime.insertAdjacentHTML("beforebegin",'<div id="updateAllButton" data-byte-update-cart style="margin-bottom: 10px;"><button>Update All</button></div>'),qs("[data-byte-update-cart]").addEventListener("click",updateCartAll)}async function updateCartAll(){var e={success:[],error:[]},t=(qs("[data-byte-update-cart]").querySelector("button").innerText="Updating...",qs("[data-byte-update-cart]").querySelector("button").disabled=!0,qsa("[data-byte-input-dirty]"));for(const i of t){delete i.dataset.byteInputDirty;var a=i.closest("tr"),r=i.closest("form"),n=a.querySelector('[data-testid="cartProductName"]').innerText,o=r.querySelector('[name="itemId"]').value,r=r.querySelector('[name="priceId"]').value,d=i.value,s=await updateCartItem(o,r,d);200===s.code&&s.message.match(pepisShop.addToCart.messages.success)?(e.success.push({itemName:n,itemId:o,priceId:r,amount:d}),a.style.borderLeft="3px solid green",a.style.borderRight="3px solid green",console.log({itemName:n,itemId:o,priceId:r,amount:d})):(a.style.borderLeft="3px solid red",a.style.borderRight="3px solid red",s.message.match(pepisShop.addToCart.messages.notEnoughStock)||s.message.match(pepisShop.addToCart.messages.notEnoughStock2)?(a=s.message.replace(/\D/g,""),a=await updateCartItem(o,r,i.value=a),console.log({itemName:n,itemId:o,priceId:r,amount:d,error:{response:s,response2:a}}),e.error.push({itemName:n,itemId:o,priceId:r,amount:d,error:{response:s,response2:a}})):(e.error.push({itemName:n,itemId:o,priceId:r,amount:d,error:s}),console.log({itemName:n,itemId:o,priceId:r,amount:d,error:s})))}console.log({log:e}),qs("[data-byte-update-cart]").querySelector("button").innerText="Update cart",qs("[data-byte-update-cart]").querySelector("button").disabled=!1}function updateCartItem(e,t,a){e=Object.entries({itemId:e,priceId:t,amount:a}).map(([e,t])=>e+"="+t).join("&");return post(pepisShop.addToCart.url,pepisShop.addToCart.headers,e)}function documentReady(e){document.addEventListener?"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e():document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&e()})}function qs(e,t=window.document){return t.querySelector(e)}function qsa(e,t=window.document){return[...t.querySelectorAll(e)]}function sleep(t){return new Promise(e=>{setTimeout(e,t)})}function post(e,t,a){return fetch(e,{method:"POST",body:a,headers:t}).then(e=>e.json())}function convertStringToNumber(e){e=e.replace("€","").replace(",",".");return parseFloat(e)}function convertNumberToString(e){return"€"+e.toFixed(2).replace(".",",")}documentReady(init);